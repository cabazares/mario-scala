{"ast":null,"code":"import _classCallCheck from \"/Users/keno/Projects/mario/client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/keno/Projects/mario/client/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport Player from './Player';\nimport Connection from './Connection';\n\nvar Game =\n/*#__PURE__*/\nfunction () {\n  function Game(width, height, context) {\n    _classCallCheck(this, Game);\n\n    this.width = width;\n    this.height = height;\n    this.context = context;\n  }\n\n  _createClass(Game, [{\n    key: \"setResources\",\n    value: function setResources(resources) {\n      this.resources = resources;\n    }\n  }, {\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      // make sure resources are loaded\n      Promise.all(Object.values(this.resources).map(function (img) {\n        return _this.checkImage(img.src);\n      })).then(function () {\n        return _this.start();\n      }); // create connection class\n\n      this.connection = new Connection();\n    }\n  }, {\n    key: \"start\",\n    value: function start() {\n      var _this2 = this;\n\n      var player = new Player(this.context, this.resources.mario);\n      this.player = player; // create connection for player\n\n      this.connection.connect(\"playerOne\");\n      this.connection.subscribe(function (action) {\n        var playerAction = action[0]; // handle position\n\n        if (playerAction.position) {\n          var _playerAction$positio = playerAction.position,\n              x = _playerAction$positio.x,\n              y = _playerAction$positio.y;\n          player.setPlayerPosition(x, y);\n        } // handle direction\n\n\n        if (playerAction.direction) {\n          player.direction = playerAction.direction;\n        }\n      });\n\n      document.onkeydown = function (e) {\n        e = e || window.event;\n\n        if (e.keyCode === 38) {\n          // up arrow\n          //player.state = 'jump';\n          _this2.connection.send(\"up\");\n        } else if (e.keyCode === 40) {\n          // down arrow\n          //player.state = 'stand';\n          _this2.connection.send(\"down\");\n        } else if (e.keyCode === 37) {\n          // left arrow\n          //player.state = 'run';\n          _this2.connection.send(\"left\");\n        } else if (e.keyCode === 39) {\n          // right arrow\n          //player.state = 'run';\n          _this2.connection.send(\"right\");\n        }\n      };\n\n      this.gameLoop();\n    }\n  }, {\n    key: \"drawBG\",\n    value: function drawBG() {\n      this.context.fillStyle = \"#5D94FB\";\n      this.context.fillRect(0, 0, this.width, this.height);\n    } // main game loop -------------------------\n\n  }, {\n    key: \"gameLoop\",\n    value: function gameLoop() {\n      var _this3 = this;\n\n      window.requestAnimationFrame(function () {\n        return _this3.gameLoop();\n      });\n      this.drawBG();\n      this.player.update();\n      this.player.draw();\n    } // UTILS ----------------------------------\n\n  }, {\n    key: \"checkImage\",\n    value: function checkImage(path) {\n      return new Promise(function (resolve) {\n        var img = new Image();\n\n        img.onload = function () {\n          return resolve({\n            path: path,\n            status: 'ok'\n          });\n        };\n\n        img.onerror = function () {\n          return resolve({\n            path: path,\n            status: 'error'\n          });\n        };\n\n        img.src = path;\n      });\n    }\n  }]);\n\n  return Game;\n}();\n\nexport default Game;","map":{"version":3,"sources":["/Users/keno/Projects/mario/client/src/Game.js"],"names":["Player","Connection","Game","width","height","context","resources","Promise","all","Object","values","map","img","checkImage","src","then","start","connection","player","mario","connect","subscribe","action","playerAction","position","x","y","setPlayerPosition","direction","document","onkeydown","e","window","event","keyCode","send","gameLoop","fillStyle","fillRect","requestAnimationFrame","drawBG","update","draw","path","resolve","Image","onload","status","onerror"],"mappings":";;AAAA,OAAOA,MAAP,MAAmB,UAAnB;AACA,OAAOC,UAAP,MAAuB,cAAvB;;IAGMC,I;;;AAEJ,gBAAYC,KAAZ,EAAmBC,MAAnB,EAA2BC,OAA3B,EAAoC;AAAA;;AAClC,SAAKF,KAAL,GAAaA,KAAb;AACA,SAAKC,MAAL,GAAcA,MAAd;AACA,SAAKC,OAAL,GAAeA,OAAf;AACD;;;;iCAEYC,S,EAAW;AACtB,WAAKA,SAAL,GAAiBA,SAAjB;AACD;;;2BAEM;AAAA;;AACL;AACAC,MAAAA,OAAO,CAACC,GAAR,CAAYC,MAAM,CAACC,MAAP,CAAc,KAAKJ,SAAnB,EAA8BK,GAA9B,CAAkC,UAAAC,GAAG;AAAA,eAAI,KAAI,CAACC,UAAL,CAAgBD,GAAG,CAACE,GAApB,CAAJ;AAAA,OAArC,CAAZ,EACeC,IADf,CACoB;AAAA,eAAM,KAAI,CAACC,KAAL,EAAN;AAAA,OADpB,EAFK,CAKL;;AACA,WAAKC,UAAL,GAAkB,IAAIhB,UAAJ,EAAlB;AACD;;;4BAEO;AAAA;;AACN,UAAMiB,MAAM,GAAG,IAAIlB,MAAJ,CAAW,KAAKK,OAAhB,EAAyB,KAAKC,SAAL,CAAea,KAAxC,CAAf;AACA,WAAKD,MAAL,GAAcA,MAAd,CAFM,CAIN;;AACA,WAAKD,UAAL,CAAgBG,OAAhB,CAAwB,WAAxB;AACA,WAAKH,UAAL,CAAgBI,SAAhB,CAA0B,UAACC,MAAD,EAAY;AAClC,YAAMC,YAAY,GAAGD,MAAM,CAAC,CAAD,CAA3B,CADkC,CAGlC;;AACA,YAAIC,YAAY,CAACC,QAAjB,EAA2B;AAAA,sCACVD,YAAY,CAACC,QADH;AAAA,cAClBC,CADkB,yBAClBA,CADkB;AAAA,cACfC,CADe,yBACfA,CADe;AAEzBR,UAAAA,MAAM,CAACS,iBAAP,CAAyBF,CAAzB,EAA4BC,CAA5B;AACD,SAPiC,CAQlC;;;AACA,YAAIH,YAAY,CAACK,SAAjB,EAA4B;AAC1BV,UAAAA,MAAM,CAACU,SAAP,GAAmBL,YAAY,CAACK,SAAhC;AACD;AACJ,OAZD;;AAcAC,MAAAA,QAAQ,CAACC,SAAT,GAAqB,UAACC,CAAD,EAAO;AACxBA,QAAAA,CAAC,GAAGA,CAAC,IAAIC,MAAM,CAACC,KAAhB;;AAEA,YAAIF,CAAC,CAACG,OAAF,KAAc,EAAlB,EAAsB;AAClB;AACD;AACA,UAAA,MAAI,CAACjB,UAAL,CAAgBkB,IAAhB,CAAqB,IAArB;AACF,SAJD,MAKK,IAAIJ,CAAC,CAACG,OAAF,KAAc,EAAlB,EAAsB;AACvB;AACD;AACA,UAAA,MAAI,CAACjB,UAAL,CAAgBkB,IAAhB,CAAqB,MAArB;AACF,SAJI,MAKA,IAAIJ,CAAC,CAACG,OAAF,KAAc,EAAlB,EAAsB;AACxB;AACA;AACA,UAAA,MAAI,CAACjB,UAAL,CAAgBkB,IAAhB,CAAqB,MAArB;AACF,SAJI,MAKA,IAAIJ,CAAC,CAACG,OAAF,KAAc,EAAlB,EAAsB;AACxB;AACA;AACA,UAAA,MAAI,CAACjB,UAAL,CAAgBkB,IAAhB,CAAqB,OAArB;AACF;AAEJ,OAxBD;;AA0BA,WAAKC,QAAL;AACD;;;6BAEQ;AACP,WAAK/B,OAAL,CAAagC,SAAb,GAAyB,SAAzB;AACA,WAAKhC,OAAL,CAAaiC,QAAb,CAAsB,CAAtB,EAAyB,CAAzB,EAA4B,KAAKnC,KAAjC,EAAwC,KAAKC,MAA7C;AACD,K,CAED;;;;+BACY;AAAA;;AAEV4B,MAAAA,MAAM,CAACO,qBAAP,CAA6B;AAAA,eAAM,MAAI,CAACH,QAAL,EAAN;AAAA,OAA7B;AAEA,WAAKI,MAAL;AACA,WAAKtB,MAAL,CAAYuB,MAAZ;AACA,WAAKvB,MAAL,CAAYwB,IAAZ;AACD,K,CAED;;;;+BACWC,I,EAAM;AACf,aAAO,IAAIpC,OAAJ,CAAY,UAAAqC,OAAO,EAAI;AAC1B,YAAMhC,GAAG,GAAG,IAAIiC,KAAJ,EAAZ;;AACAjC,QAAAA,GAAG,CAACkC,MAAJ,GAAa;AAAA,iBAAMF,OAAO,CAAC;AAACD,YAAAA,IAAI,EAAJA,IAAD;AAAOI,YAAAA,MAAM,EAAE;AAAf,WAAD,CAAb;AAAA,SAAb;;AACAnC,QAAAA,GAAG,CAACoC,OAAJ,GAAc;AAAA,iBAAMJ,OAAO,CAAC;AAACD,YAAAA,IAAI,EAAJA,IAAD;AAAOI,YAAAA,MAAM,EAAE;AAAf,WAAD,CAAb;AAAA,SAAd;;AAEAnC,QAAAA,GAAG,CAACE,GAAJ,GAAU6B,IAAV;AACH,OANM,CAAP;AAOD;;;;;;AAIH,eAAezC,IAAf","sourcesContent":["import Player from './Player';\nimport Connection from './Connection'\n\n\nclass Game {\n\n  constructor(width, height, context) {\n    this.width = width;\n    this.height = height;\n    this.context = context;\n  }\n\n  setResources(resources) {\n    this.resources = resources;\n  }\n\n  init() {\n    // make sure resources are loaded\n    Promise.all(Object.values(this.resources).map(img => this.checkImage(img.src)))\n                  .then(() => this.start());\n\n    // create connection class\n    this.connection = new Connection()\n  }\n\n  start() {\n    const player = new Player(this.context, this.resources.mario);\n    this.player = player;\n\n    // create connection for player\n    this.connection.connect(\"playerOne\")\n    this.connection.subscribe((action) => {\n        const playerAction = action[0]\n\n        // handle position\n        if (playerAction.position) {\n          const {x, y} = playerAction.position\n          player.setPlayerPosition(x, y)\n        }\n        // handle direction\n        if (playerAction.direction) {\n          player.direction = playerAction.direction\n        }\n    })\n\n    document.onkeydown = (e) => {\n        e = e || window.event;\n\n        if (e.keyCode === 38) {\n            // up arrow\n           //player.state = 'jump';\n           this.connection.send(\"up\")\n        }\n        else if (e.keyCode === 40) {\n            // down arrow\n           //player.state = 'stand';\n           this.connection.send(\"down\")\n        }\n        else if (e.keyCode === 37) {\n           // left arrow\n           //player.state = 'run';\n           this.connection.send(\"left\")\n        }\n        else if (e.keyCode === 39) {\n           // right arrow\n           //player.state = 'run';\n           this.connection.send(\"right\")\n        }\n\n    }\n\n    this.gameLoop();\n  }\n\n  drawBG() {\n    this.context.fillStyle = \"#5D94FB\";\n    this.context.fillRect(0, 0, this.width, this.height);\n  }\n\n  // main game loop -------------------------\n  gameLoop () {\n\n    window.requestAnimationFrame(() => this.gameLoop());\n\n    this.drawBG();\n    this.player.update();\n    this.player.draw();\n  }\n\n  // UTILS ----------------------------------\n  checkImage(path) {\n    return new Promise(resolve => {\n        const img = new Image();\n        img.onload = () => resolve({path, status: 'ok'});\n        img.onerror = () => resolve({path, status: 'error'});\n\n        img.src = path;\n    });\n  }\n\n}\n\nexport default Game;\n"]},"metadata":{},"sourceType":"module"}
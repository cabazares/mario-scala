{"ast":null,"code":"import _classCallCheck from \"/Users/keno/Projects/mario/client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/keno/Projects/mario/client/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _objectSpread from \"/Users/keno/Projects/mario/client/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nvar PlayerStates = {\n  STAND: \"stand\",\n  RUN: \"run\",\n  JUMP: \"jump\"\n};\nvar MarioFrames = {\n  STAND: {\n    height: 32,\n    width: 32,\n    offsetX: 160,\n    offsetY: 68,\n    count: 1\n  },\n  RUN: {\n    height: 32,\n    width: 32,\n    offsetX: 194,\n    offsetY: 68,\n    count: 3\n  },\n  JUMP: {\n    height: 32,\n    width: 32,\n    offsetX: 330,\n    offsetY: 68,\n    count: 1\n  }\n};\nvar LuigiFrames = {\n  STAND: _objectSpread({}, MarioFrames.STAND, {\n    offsetY: MarioFrames.STAND.offsetY + 130\n  }),\n  RUN: _objectSpread({}, MarioFrames.RUN, {\n    offsetY: MarioFrames.RUN.offsetY + 130\n  }),\n  JUMP: _objectSpread({}, MarioFrames.JUMP, {\n    offsetY: MarioFrames.JUMP.offsetY + 130\n  })\n};\nvar PlayerDirection = {\n  LEFT: 'left',\n  RIGHT: 'right'\n};\nvar SHEET_GAP = 2;\n\nvar Player =\n/*#__PURE__*/\nfunction () {\n  function Player(swidth, sheight, context, sheet, name) {\n    _classCallCheck(this, Player);\n\n    this.imgCache = {};\n    this.swidth = swidth;\n    this.sheight = sheight;\n    this.context = context;\n    this.sheet = sheet;\n    this.name = name;\n    this.position = {\n      x: 0,\n      y: 0\n    };\n    this.state = PlayerStates.RUN;\n    this.direction = PlayerDirection.RIGHT;\n    this.frameIndex = 0;\n    this.tickCount = 0;\n    this.ticksPerFrame = 4;\n    this.buffer = document.createElement('canvas');\n    this.bufferctx = this.buffer.getContext('2d'); // TODO: generate all images in cache\n  }\n\n  _createClass(Player, [{\n    key: \"setPlayerPosition\",\n    value: function setPlayerPosition(x, y) {\n      this.position.x = x;\n      this.position.y = y;\n    }\n  }, {\n    key: \"setPlayerState\",\n    value: function setPlayerState(state) {\n      this.state = state;\n    }\n  }, {\n    key: \"update\",\n    value: function update() {\n      var frameInfo = this.getFrameInfo();\n      this.tickCount++;\n\n      if (this.tickCount > this.ticksPerFrame) {\n        this.tickCount = 0;\n        this.frameIndex++;\n        this.frameIndex = this.frameIndex < frameInfo.count ? this.frameIndex : 0;\n      }\n    }\n  }, {\n    key: \"getFrameInfo\",\n    value: function getFrameInfo() {\n      var frame = PlayerFrames.STAND;\n\n      if (this.state === PlayerStates.STAND) {\n        frame = PlayerFrames.STAND;\n      } else if (this.state === PlayerStates.RUN) {\n        frame = PlayerFrames.RUN;\n      } else if (this.state === PlayerStates.JUMP) {\n        frame = PlayerFrames.JUMP;\n      }\n\n      return frame;\n    }\n  }, {\n    key: \"getSheetImage\",\n    value: function getSheetImage(sheet, x, y, width, height, direction) {\n      var key = [x, y, width, height, direction].join('_');\n\n      if (!this.imgCache[key]) {\n        this.bufferctx.clearRect(0, 0, this.buffer.width, this.buffer.height);\n        this.bufferctx.setTransform(1, 0, 0, 1, 0, 0);\n\n        if (direction === PlayerDirection.LEFT) {\n          this.bufferctx.translate(width, 0);\n          this.bufferctx.scale(-1, 1);\n        }\n\n        this.bufferctx.drawImage(this.sheet, x, y, width, height, 0, 0, width, height);\n        var image = new Image();\n        image.src = this.buffer.toDataURL();\n        this.imgCache[key] = image;\n      }\n\n      return this.imgCache[key];\n    }\n  }, {\n    key: \"draw\",\n    value: function draw() {\n      var frameInfo = this.getFrameInfo(); // get frame based on index\n\n      var frameX = frameInfo.offsetX + (frameInfo.width + SHEET_GAP) * this.frameIndex;\n      var sheetImage = this.getSheetImage(this.sheet, frameX, frameInfo.offsetY, frameInfo.width, frameInfo.height, this.direction);\n      this.context.drawImage(sheetImage, this.position.x, this.sheight - this.position.y - frameInfo.height);\n    }\n  }]);\n\n  return Player;\n}();\n\nexport default Player;","map":{"version":3,"sources":["/Users/keno/Projects/mario/client/src/Player.js"],"names":["PlayerStates","STAND","RUN","JUMP","MarioFrames","height","width","offsetX","offsetY","count","LuigiFrames","PlayerDirection","LEFT","RIGHT","SHEET_GAP","Player","swidth","sheight","context","sheet","name","imgCache","position","x","y","state","direction","frameIndex","tickCount","ticksPerFrame","buffer","document","createElement","bufferctx","getContext","frameInfo","getFrameInfo","frame","PlayerFrames","key","join","clearRect","setTransform","translate","scale","drawImage","image","Image","src","toDataURL","frameX","sheetImage","getSheetImage"],"mappings":"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","sourcesContent":["\nconst PlayerStates = {\n  STAND: \"stand\",\n  RUN: \"run\",\n  JUMP: \"jump\",\n}\n\nconst MarioFrames = {\n  STAND: {\n    height: 32,\n    width: 32,\n    offsetX: 160,\n    offsetY: 68,\n    count: 1,\n  },\n  RUN: {\n    height: 32,\n    width: 32,\n    offsetX: 194,\n    offsetY: 68,\n    count: 3,\n  },\n  JUMP: {\n    height: 32,\n    width: 32,\n    offsetX: 330,\n    offsetY: 68,\n    count: 1,\n  },\n}\n\nconst LuigiFrames = {\n  STAND: {\n    ...MarioFrames.STAND,\n    offsetY: MarioFrames.STAND.offsetY + 130\n  },\n  RUN: {\n    ...MarioFrames.RUN,\n    offsetY: MarioFrames.RUN.offsetY + 130\n  },\n  JUMP: {\n    ...MarioFrames.JUMP,\n    offsetY: MarioFrames.JUMP.offsetY + 130\n  },\n}\n\n\nconst PlayerDirection = {\n  LEFT: 'left',\n  RIGHT: 'right',\n}\n\nconst SHEET_GAP = 2;\n\n\nclass Player {\n  constructor(swidth, sheight, context, sheet, name) {\n    this.swidth = swidth;\n    this.sheight = sheight;\n    this.context = context;\n    this.sheet = sheet;\n    this.name = name;\n\n    this.position = {\n      x: 0,\n      y: 0,\n    }\n    this.state = PlayerStates.RUN;\n    this.direction = PlayerDirection.RIGHT;\n\n    this.frameIndex = 0;\n    this.tickCount = 0;\n    this.ticksPerFrame = 4;\n\n    this.buffer = document.createElement('canvas');\n    this.bufferctx = this.buffer.getContext('2d');\n\n    // TODO: generate all images in cache\n  }\n\n  setPlayerPosition(x, y) {\n    this.position.x = x;\n    this.position.y = y;\n  }\n\n  setPlayerState(state) {\n    this.state = state;\n  }\n\n  update() {\n    const frameInfo = this.getFrameInfo();\n    this.tickCount++;\n    if (this.tickCount > this.ticksPerFrame) {\n      this.tickCount = 0;\n      this.frameIndex++;\n      this.frameIndex = (this.frameIndex < frameInfo.count)? this.frameIndex : 0; \n    }\n  }\n\n  getFrameInfo() {\n    let frame = PlayerFrames.STAND;\n    if (this.state === PlayerStates.STAND) { \n      frame = PlayerFrames.STAND;\n    } else if (this.state === PlayerStates.RUN) {\n      frame = PlayerFrames.RUN;\n    } else if (this.state === PlayerStates.JUMP) {\n      frame = PlayerFrames.JUMP;\n    }\n    return frame;\n  }\n\n  imgCache = {}\n  getSheetImage(sheet, x, y, width, height, direction) {\n    const key = [x, y, width, height, direction].join('_');\n\n    if (!this.imgCache[key]) {\n      this.bufferctx.clearRect(0, 0, this.buffer.width, this.buffer.height);\n      this.bufferctx.setTransform(1, 0, 0, 1, 0, 0);\n      if (direction === PlayerDirection.LEFT) {\n        this.bufferctx.translate(width, 0);\n        this.bufferctx.scale(-1, 1);\n      }\n      this.bufferctx.drawImage(this.sheet, x, y, width, height, 0, 0, width, height);\n\n      const image = new Image();\n      image.src = this.buffer.toDataURL();\n      this.imgCache[key] = image;\n    }\n    return this.imgCache[key];\n  }\n\n  draw() {\n    const frameInfo = this.getFrameInfo();\n    // get frame based on index\n    const frameX = frameInfo.offsetX + ((frameInfo.width + SHEET_GAP) * this.frameIndex);\n\n    const sheetImage = this.getSheetImage(this.sheet, frameX, frameInfo.offsetY,\n                                          frameInfo.width, frameInfo.height,\n                                          this.direction);\n    this.context.drawImage(sheetImage,\n                           this.position.x,\n                           this.sheight - this.position.y - frameInfo.height);\n  }\n}\n\nexport default Player;\n"]},"metadata":{},"sourceType":"module"}